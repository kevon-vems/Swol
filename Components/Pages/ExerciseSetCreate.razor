@page "/exercisesets/create"
@inject Swol.Data.ApplicationDbContext Db
@inject NavigationManager Nav
@using Swol.Data.Models
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.WebUtilities

<PageTitle>Add Exercise Set</PageTitle>

<div class="max-w-4xl mx-auto p-4 space-y-6">

<h1 class="text-2xl font-bold mb-6">Add Exercise Set</h1>

<EditForm Model="@set" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary class="mb-4 text-red-600" />
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Workout Log</label>
            <InputSelect class="block w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" @bind-Value="set.WorkoutLogId">
                <option value="">-- Select Workout Log --</option>
                @foreach (var log in workoutLogs)
                {
                    <option value="@log.Id">@log.StartTime.ToShortDateString() - @log.Workout?.Name</option>
                }
            </InputSelect>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Exercise</label>
            <InputSelect class="block w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" @bind-Value="set.ExerciseId">
                <option value="">-- Select Exercise --</option>
                @foreach (var exercise in exercises)
                {
                    <option value="@exercise.Id">@exercise.Name</option>
                }
            </InputSelect>
        </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Set Number</label>
            <InputNumber class="block w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" @bind-Value="set.SetNumber" />
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Reps</label>
            <InputNumber class="block w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" @bind-Value="set.Reps" />
        </div>
    </div>
    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow">Save</button>
    <a class="ml-3 bg-gray-200 hover:bg-gray-300 text-black font-semibold py-2 px-4 rounded shadow" href="/exercisesets">Cancel</a>
</EditForm>

</div>

@code {
    private ExerciseSet set = new ExerciseSet();
    private List<WorkoutLog> workoutLogs = new List<WorkoutLog>();
    private List<Exercise> exercises = new List<Exercise>();
    protected override async Task OnInitializedAsync()
    {
        workoutLogs = await Db.WorkoutLogs.Include(wl => wl.Workout).ToListAsync();
        exercises = await Db.Exercises.ToListAsync();
    }
    private async Task HandleValidSubmit()
    {
        Db.ExerciseSets.Add(set);
        await Db.SaveChangesAsync();
        Nav.NavigateTo("/exercisesets");
    }
}
